{% extends "base.html" %}

{% block content %}

<style>
/* Page fade-in */
.profile-wrapper {
    animation: fadeIn 0.5s ease-in-out;
}

/* Main card */
.profile-card {
    border-radius: 24px;
    padding: 50px;
    background: white;
    box-shadow: 0 12px 28px rgba(0,0,0,0.08);
    animation: fadeIn 0.6s ease;
    transition: transform 0.3s ease;
}

.profile-card:hover {
    transform: translateY(-4px);
}

/* Profile photo */
.profile-photo {
    width: 170px;
    height: 170px;
    object-fit: cover;
    border-radius: 160px;
    border: 5px solid #0d6efd;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
}

/* Text */
.profile-name {
    font-size: 2.3rem;
    font-weight: 800;
    color: #1a1a1a;
}

.profile-email {
    font-size: 1.15rem;
    color: #5d6b77;
}

.profile-role {
    padding: 8px 16px;
    border-radius: 7px;
    font-size: 0.95rem;
}

/* Resume link */
.resume-link a {
    font-weight: 600;
    color: #0d6efd;
}
.resume-link a:hover {
    text-decoration: underline;
}

/* Edit button */
.edit-btn {
    padding: 12px 24px;
    border-radius: 10px;
    font-size: 1rem;
}

/* Modal styling */
.modal-content {
    border-radius: 18px;
    padding: 10px 5px;
    box-shadow: 0 10px 28px rgba(0,0,0,0.15);
}

.modal-title {
    font-size: 1.4rem;
    font-weight: 700;
}

.modal-body label {
    font-weight: 600;
}

.modal-body input {
    border-radius: 10px !important;
}

/* Profile preview */
#profilePicPreview {
    border-radius: 8px;
    width: 130px;
    height: 130px;
    object-fit: cover;
}

/* Animation */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

<!-- ============================= -->
<!-- Main Profile Card -->
<!-- ============================= -->

<div class="profile-wrapper d-flex justify-content-center mt-4">
    <div class="profile-card card mx-auto" style="max-width: 900px;">

        <div class="d-flex align-items-center">

            <!-- Profile Picture -->
            <img 
                src="{{ url_for('static', filename='profile_pics/' ~ user.profile_picture) if user.profile_picture else url_for('static', filename='default-avatar.png') }}"
                alt="Profile Picture"
                class="profile-photo me-4"
            />

            <!-- User Info -->
            <div class="flex-grow-1 ms-2">
                <h2 class="profile-name">{{ user.username }}</h2>
                <p class="profile-email">{{ user.email }}</p>
                <span class="badge bg-primary profile-role">{{ user.role }}</span>
            </div>

            <!-- Edit Button -->
            <button
                type="button"
                class="btn btn-primary edit-btn"
                data-bs-toggle="modal"
                data-bs-target="#editProfileModal"
            >
                Edit Profile
            </button>
        </div>

        <!-- Resume Section -->
        {% if user.resume_filename %}
        <div class="mt-5 resume-link">
            <h5 class="fw-bold mb-2">Resume:</h5>
            <a href="{{ url_for('static', filename='uploads/' ~ user.resume_filename) }}" target="_blank">
                View Uploaded Resume
            </a>
        </div>
        {% endif %}
    </div>
</div>


<!-- ============================= -->
<!-- Edit Profile Modal -->
<!-- ============================= -->

<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header border-0">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form method="POST" enctype="multipart/form-data">
          {{ form.hidden_tag() }}

          <!-- Username -->
          <div class="mb-3">
            {{ form.username.label(class="form-label") }}
            {{ form.username(class="form-control") }}
          </div>

          <!-- Email -->
          <div class="mb-3">
            {{ form.email.label(class="form-label") }}
            {{ form.email(class="form-control") }}
          </div>

          <!-- Password -->
          <div class="mb-3">
            {{ form.password.label(class="form-label") }}
            {{ form.password(class="form-control") }}
          </div>

          <!-- Resume -->
          <div class="mb-3">
            {{ form.resume.label(class="form-label") }}
            {{ form.resume(class="form-control") }}
          </div>

          <!-- Profile Picture -->
          <div class="mb-3">
            <label class="form-label">Profile Picture</label>
            {{ form.profile_picture(class="form-control", id="profilePicInput") }}
            <img
              id="profilePicPreview"
              src="#"
              class="img-thumbnail mt-3 d-none"
            />
          </div>

          <!-- Buttons -->
          <div class="text-end mt-4">
            {{ form.submit(class="btn btn-success px-4 py-2") }}
            <button type="button" class="btn btn-secondary px-4 py-2 ms-2" data-bs-dismiss="modal">
              Cancel
            </button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>

<!-- ============================= -->
<!-- Live Image Preview Script -->
<!-- ============================= -->

<script>
  const input = document.getElementById("profilePicInput");
  const preview = document.getElementById("profilePicPreview");

  input?.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.classList.remove("d-none");
    }
  });
</script>

{% endblock %}
